<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Quiz Color Contrast Verification</title>
    <style>
      body {
        font-family:
          system-ui,
          -apple-system,
          sans-serif;
        max-width: 1200px;
        margin: 40px auto;
        padding: 20px;
      }

      h1 {
        margin-bottom: 30px;
      }

      .test-group {
        margin-bottom: 40px;
      }

      .test-item {
        display: flex;
        align-items: center;
        gap: 20px;
        margin-bottom: 15px;
        padding: 15px;
        border: 1px solid #ccc;
        border-radius: 8px;
      }

      .color-swatch {
        min-width: 200px;
        min-height: 60px;
        padding: 10px;
        border-radius: 4px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 500;
      }

      .info {
        flex: 1;
      }

      .ratio {
        font-size: 24px;
        font-weight: bold;
        min-width: 100px;
      }

      .pass {
        color: #059669;
      }

      .fail {
        color: #dc2626;
      }

      .label {
        font-size: 12px;
        color: #666;
        margin-bottom: 5px;
      }

      .requirement {
        font-size: 14px;
        color: #666;
        margin-top: 5px;
      }
    </style>
  </head>
  <body>
    <h1>Decision Quiz - WCAG AA Contrast Verification</h1>

    <div class="test-group">
      <h2>Light Mode</h2>

      <div class="test-item">
        <div
          class="color-swatch"
          style="background: oklch(1 0 0); color: oklch(0.129 0.042 264.695)"
        >
          <div>
            <div style="font-size: 24px; font-weight: 600">Question Title</div>
            <div style="font-size: 14px">This is a question description</div>
          </div>
        </div>
        <div class="info">
          <div class="label">foreground on background</div>
          <div><code>oklch(0.129 0.042 264.695)</code> on <code>oklch(1 0 0)</code></div>
          <div class="requirement">Used for: Question titles, main text</div>
        </div>
        <div class="ratio" data-fg="oklch(0.129 0.042 264.695)" data-bg="oklch(1 0 0)">
          Calculating...
        </div>
      </div>

      <div class="test-item">
        <div
          class="color-swatch"
          style="background: oklch(1 0 0); color: oklch(0.554 0.046 257.417)"
        >
          <div style="font-size: 14px">
            Examples: Page headers, sidebars, breadcrumbs, meta tags
          </div>
        </div>
        <div class="info">
          <div class="label">muted-foreground on background</div>
          <div><code>oklch(0.554 0.046 257.417)</code> on <code>oklch(1 0 0)</code></div>
          <div class="requirement">Used for: Question descriptions, helper text</div>
        </div>
        <div class="ratio" data-fg="oklch(0.554 0.046 257.417)" data-bg="oklch(1 0 0)">
          Calculating...
        </div>
      </div>

      <div class="test-item">
        <div
          class="color-swatch"
          style="background: oklch(0.968 0.007 247.896); color: oklch(0.129 0.042 264.695)"
        >
          <div style="font-weight: 500">Yes</div>
          <div style="font-size: 14px">I need to pass data up the layout tree</div>
        </div>
        <div class="info">
          <div class="label">foreground on muted (answer buttons)</div>
          <div>
            <code>oklch(0.129 0.042 264.695)</code> on <code>oklch(0.968 0.007 247.896)</code>
          </div>
          <div class="requirement">Used for: Answer choice buttons</div>
        </div>
        <div
          class="ratio"
          data-fg="oklch(0.129 0.042 264.695)"
          data-bg="oklch(0.968 0.007 247.896)"
        >
          Calculating...
        </div>
      </div>

      <div class="test-item">
        <div class="color-swatch" style="background: #4f46e5; color: #ffffff">
          <div style="font-weight: 500">Quick Start with CLI</div>
        </div>
        <div class="info">
          <div class="label">white on indigo-600 (primary CTA)</div>
          <div><code>#ffffff</code> on <code>#4f46e5</code></div>
          <div class="requirement">Used for: Primary action buttons</div>
        </div>
        <div class="ratio" data-fg="#ffffff" data-bg="#4f46e5">Calculating...</div>
      </div>

      <div class="test-item">
        <div
          class="color-swatch"
          style="
            background: rgba(99, 102, 241, 0.05);
            color: oklch(0.129 0.042 264.695);
            border: 1px solid rgba(99, 102, 241, 0.2);
          "
        >
          <div style="font-weight: 500; display: flex; align-items: center; gap: 8px">
            <svg width="20" height="20" fill="#4f46e5"><circle cx="10" cy="10" r="8" /></svg>
            Why this recommendation?
          </div>
        </div>
        <div class="info">
          <div class="label">foreground text on indigo-500/5 background (FIXED)</div>
          <div>
            <code>oklch(0.129 0.042 264.695)</code> on <code>rgba(99, 102, 241, 0.05)</code>
          </div>
          <div class="requirement">
            Used for: Explanation box text (icon stays indigo for accent)
          </div>
        </div>
        <div class="ratio" data-fg="oklch(0.129 0.042 264.695)" data-bg="rgba(99, 102, 241, 0.05)">
          Calculating...
        </div>
      </div>
    </div>

    <div class="test-group">
      <h2>Dark Mode</h2>

      <div class="test-item">
        <div
          class="color-swatch"
          style="background: oklch(0.129 0.042 264.695); color: oklch(0.984 0.003 247.858)"
        >
          <div>
            <div style="font-size: 24px; font-weight: 600">Question Title</div>
            <div style="font-size: 14px">This is a question description</div>
          </div>
        </div>
        <div class="info">
          <div class="label">foreground on background (dark)</div>
          <div>
            <code>oklch(0.984 0.003 247.858)</code> on <code>oklch(0.129 0.042 264.695)</code>
          </div>
          <div class="requirement">Used for: Question titles, main text</div>
        </div>
        <div
          class="ratio"
          data-fg="oklch(0.984 0.003 247.858)"
          data-bg="oklch(0.129 0.042 264.695)"
        >
          Calculating...
        </div>
      </div>

      <div class="test-item">
        <div
          class="color-swatch"
          style="background: oklch(0.129 0.042 264.695); color: oklch(0.704 0.04 256.788)"
        >
          <div style="font-size: 14px">
            Examples: Page headers, sidebars, breadcrumbs, meta tags
          </div>
        </div>
        <div class="info">
          <div class="label">muted-foreground on background (dark)</div>
          <div>
            <code>oklch(0.704 0.04 256.788)</code> on <code>oklch(0.129 0.042 264.695)</code>
          </div>
          <div class="requirement">Used for: Question descriptions, helper text</div>
        </div>
        <div class="ratio" data-fg="oklch(0.704 0.04 256.788)" data-bg="oklch(0.129 0.042 264.695)">
          Calculating...
        </div>
      </div>

      <div class="test-item">
        <div
          class="color-swatch"
          style="background: oklch(0.279 0.041 260.031); color: oklch(0.984 0.003 247.858)"
        >
          <div style="font-weight: 500">Yes</div>
          <div style="font-size: 14px">I need to pass data up the layout tree</div>
        </div>
        <div class="info">
          <div class="label">foreground on muted (answer buttons, dark)</div>
          <div>
            <code>oklch(0.984 0.003 247.858)</code> on <code>oklch(0.279 0.041 260.031)</code>
          </div>
          <div class="requirement">Used for: Answer choice buttons</div>
        </div>
        <div
          class="ratio"
          data-fg="oklch(0.984 0.003 247.858)"
          data-bg="oklch(0.279 0.041 260.031)"
        >
          Calculating...
        </div>
      </div>

      <div class="test-item">
        <div class="color-swatch" style="background: #818cf8; color: oklch(0.129 0.042 264.695)">
          <svg width="20" height="20" fill="currentColor"><circle cx="10" cy="10" r="8" /></svg>
        </div>
        <div class="info">
          <div class="label">indigo-400 icon on dark background</div>
          <div><code>#818cf8</code> on <code>oklch(0.129 0.042 264.695)</code></div>
          <div class="requirement">Used for: Progress dots, icons</div>
        </div>
        <div class="ratio" data-fg="#818cf8" data-bg="oklch(0.129 0.042 264.695)">
          Calculating...
        </div>
      </div>
    </div>

    <div style="margin-top: 40px; padding: 20px; background: #f3f4f6; border-radius: 8px">
      <h3>WCAG AA Requirements:</h3>
      <ul>
        <li><strong>Normal text</strong> (&lt;18pt or &lt;14pt bold): Contrast ratio ≥ 4.5:1</li>
        <li><strong>Large text</strong> (≥18pt or ≥14pt bold): Contrast ratio ≥ 3:1</li>
        <li><strong>UI components and graphics</strong>: Contrast ratio ≥ 3:1</li>
      </ul>
    </div>

    <script>
      // Convert OKLCH to RGB
      function oklchToRgb(oklchString) {
        // Parse oklch(L C H) format
        const match = oklchString.match(/oklch\(([\d.]+)\s+([\d.]+)\s+([\d.]+)\)/);
        if (!match) {
          // Try parsing as hex
          if (oklchString.startsWith('#')) {
            return hexToRgb(oklchString);
          }
          // Try parsing as rgba
          if (oklchString.startsWith('rgba')) {
            const rgbaMatch = oklchString.match(
              /rgba\(([\d.]+),\s*([\d.]+),\s*([\d.]+),\s*([\d.]+)\)/
            );
            if (rgbaMatch) {
              return [parseInt(rgbaMatch[1]), parseInt(rgbaMatch[2]), parseInt(rgbaMatch[3])];
            }
          }
          return null;
        }

        const l = parseFloat(match[1]);
        const c = parseFloat(match[2]);
        const h = parseFloat(match[3]);

        // Convert OKLCH to RGB (simplified conversion)
        // This uses the oklab color space conversion
        const a = c * Math.cos((h * Math.PI) / 180);
        const b = c * Math.sin((h * Math.PI) / 180);

        // OKLab to linear RGB
        const l_ = l + 0.3963377774 * a + 0.2158037573 * b;
        const m_ = l - 0.1055613458 * a - 0.0638541728 * b;
        const s_ = l - 0.0894841775 * a - 1.291485548 * b;

        const l3 = l_ * l_ * l_;
        const m3 = m_ * m_ * m_;
        const s3 = s_ * s_ * s_;

        let r = +4.0767416621 * l3 - 3.3077115913 * m3 + 0.2309699292 * s3;
        let g = -1.2684380046 * l3 + 2.6097574011 * m3 - 0.3413193965 * s3;
        let b_rgb = -0.0041960863 * l3 - 0.7034186147 * m3 + 1.707614701 * s3;

        // Apply gamma correction
        r = gammaCorrect(r);
        g = gammaCorrect(g);
        b_rgb = gammaCorrect(b_rgb);

        // Clamp and convert to 0-255 range
        r = Math.max(0, Math.min(1, r)) * 255;
        g = Math.max(0, Math.min(1, g)) * 255;
        b_rgb = Math.max(0, Math.min(1, b_rgb)) * 255;

        return [Math.round(r), Math.round(g), Math.round(b_rgb)];
      }

      function gammaCorrect(val) {
        if (val >= 0.0031308) {
          return 1.055 * Math.pow(val, 1 / 2.4) - 0.055;
        } else {
          return 12.92 * val;
        }
      }

      function hexToRgb(hex) {
        const result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
        return result
          ? [parseInt(result[1], 16), parseInt(result[2], 16), parseInt(result[3], 16)]
          : null;
      }

      // Calculate relative luminance
      function getLuminance(rgb) {
        const [r, g, b] = rgb.map((val) => {
          val = val / 255;
          return val <= 0.03928 ? val / 12.92 : Math.pow((val + 0.055) / 1.055, 2.4);
        });
        return 0.2126 * r + 0.7152 * g + 0.0722 * b;
      }

      // Calculate contrast ratio
      function getContrastRatio(fg, bg) {
        const fgLum = getLuminance(fg);
        const bgLum = getLuminance(bg);
        const lighter = Math.max(fgLum, bgLum);
        const darker = Math.min(fgLum, bgLum);
        return (lighter + 0.05) / (darker + 0.05);
      }

      // Check all test items
      document.querySelectorAll('.test-item').forEach((item) => {
        const ratioEl = item.querySelector('.ratio');
        const fg = ratioEl.dataset.fg;
        const bg = ratioEl.dataset.bg;

        const fgRgb = oklchToRgb(fg);
        const bgRgb = oklchToRgb(bg);

        if (fgRgb && bgRgb) {
          const ratio = getContrastRatio(fgRgb, bgRgb);
          const passes = ratio >= 4.5;

          ratioEl.innerHTML = `
          <div class="${passes ? 'pass' : 'fail'}">${ratio.toFixed(2)}:1</div>
          <div style="font-size: 14px; margin-top: 5px;">
            ${passes ? '✓ PASS' : '✗ FAIL'} AA
          </div>
        `;
        } else {
          ratioEl.innerHTML = '<div class="fail">Error</div>';
          console.error('Could not parse colors:', fg, bg);
        }
      });
    </script>
  </body>
</html>
